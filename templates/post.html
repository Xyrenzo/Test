<!DOCTYPE html>
<html lang="{{ lang }}">
<head> 
    <meta charset="UTF-8">
    <title>–õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/button.css">
</head>
<body>
    <header>
        <form method="post" action="/change_language">
            <input type="hidden" name="user_id" value="{{ user_id }}">
            <select name="language" onchange="this.form.submit()">
                <option value="ru" {% if lang=='ru' %}selected{% endif %}>üá∑üá∫</option>
                <option value="en" {% if lang=='en' %}selected{% endif %}>üá∫üá∏</option>
                <option value="ja" {% if lang=='ja' %}selected{% endif %}>üáØüáµ</option>
                <option value="ko" {% if lang=='ko' %}selected{% endif %}>üá∞üá∑</option>
                <option value="zh" {% if lang=='zh' %}selected{% endif %}>üá®üá≥</option>
                <option value="es" {% if lang=='es' %}selected{% endif %}>üá™üá∏</option>
                <option value="pt" {% if lang=='pt' %}selected{% endif %}>üáµüáπ</option>
            </select>
        </form>
    </header>
    <div class="filters">
        <a href="/post/{{ lang }}/all?user_id={{ user_id }}" class="btn {% if filter=='all' %}active{% endif %}">–í—Å–µ</a>
        <a href="/post/{{ lang }}/unread?user_id={{ user_id }}" class="btn {% if filter=='unread' %}active{% endif %}">–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</a>
        <a href="/post/{{ lang }}/read?user_id={{ user_id }}" class="btn {% if filter=='read' %}active{% endif %}">–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</a>
    </div>

    {% for post in posts %}
    <div class="post-container" data-post-id="{{ post.id }}">
        <div class="post-header">
            <img src="https://i.imgur.com/5q8hZLh.png" class="avatar">
            <div class="header-text">
                <div class="channel-name">Test</div>
                <div class="time">3 —á–∞—Å–∞ –Ω–∞–∑–∞–¥</div>
            </div>
        </div>
        <div class="image-stack">
            {% for img in post.images %}
                <img src="{{ img }}" class="fibonacci-img img-{{ loop.index }}">
            {% endfor %}
        </div>
        <div class="post-actions">
            <span class="like">‚ù§Ô∏è</span>
            <span class="star">‚≠ê</span>
        </div>
        <div class="post-title">{{ post.title }}</div>
        <div class="post-body">{{ post.body }}</div>

        <a href="/post/{{ post.id }}/comments/{{ lang }}?user_id={{ user_id }}">
            <button class="button">
                <span class="state state--default">
                    <span class="icon">
                        <svg width="15" height="15" viewBox="0 0 24 24" fill="none">
                            <path d="M21 11.5L3 3l2.5 8.5L3 20l18-8.5Z" fill="currentColor"/>
                        </svg>
                    </span>
                    <p>
                        <span style="--i:1">–ü</span>
                        <span style="--i:2">–æ</span>
                        <span style="--i:3">–∫</span>
                        <span style="--i:4">–∞</span>
                        <span style="--i:5">–∑</span>
                        <span style="--i:6">–∞</span>
                        <span style="--i:7">—Ç</span>
                        <span style="--i:8">&nbsp;</span>
                        <span style="--i:9">–∫</span>
                        <span style="--i:10">–æ</span>
                        <span style="--i:11">–º</span>
                        <span style="--i:12">–º</span>
                        <span style="--i:13">–µ</span>
                        <span style="--i:14">–Ω</span>
                        <span style="--i:15">—Ç</span>
                        <span style="--i:16">–∞</span>
                        <span style="--i:17">—Ä</span>
                        <span style="--i:18">–∏</span>
                        <span style="--i:19">–∏</span>
                    </p>
                </span>
                <span class="state state--sent">
                    <span class="icon">
                        <svg width="15" height="15" viewBox="0 0 24 24" fill="none">
                            <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </span>
                    <p>
                        <span style="--i:1">–û</span>
                        <span style="--i:2">—Ç</span>
                        <span style="--i:3">–∫</span>
                        <span style="--i:4">—Ä</span>
                        <span style="--i:5">—ã</span>
                        <span style="--i:6">—Ç</span>
                        <span style="--i:7">–æ</span>
                    </p>
                </span>
                <span class="outline"></span>
            </button>
        </a>
    </div>
    {% endfor %}

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const post = entry.target.closest(".post-container");
                        const postId = post.dataset.postId;
                        fetch(`/mark_read/${postId}?user_id={{ user_id }}`, {method: "POST"});
                    }
                });
            }, { threshold: 1.0 });

            document.querySelectorAll(".button").forEach(btn => {
                observer.observe(btn);
            });
        });
    </script>
</body>
</html>
