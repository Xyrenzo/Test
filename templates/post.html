<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <title>Ğ›ĞµĞ½Ñ‚Ğ° Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <form method="post" action="/set-language">
             <select name="language" onchange="this.form.submit()">
                 <option value="ru" selected>ğŸ‡·ğŸ‡º</option> 
                 <option value="en">ğŸ‡ºğŸ‡¸</option>
                 <option value="ja">ğŸ‡¯ğŸ‡µ</option>
                 <option value="ko">ğŸ‡°ğŸ‡·</option>
                 <option value="zh">ğŸ‡¨ğŸ‡³</option>
                 <option value="es">ğŸ‡ªğŸ‡¸</option>
                 <option value="pt">ğŸ‡µğŸ‡¹</option>
             </select>
        </form>
    </header>
    <div class="filters">
        <a href="/post/{{ lang }}/all" class="btn {% if filter=='all' %}active{% endif %}">Ğ’ÑĞµ</a>
        <a href="/post/{{ lang }}/unread" class="btn {% if filter=='unread' %}active{% endif %}">ĞĞµĞ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ğµ</a>
        <a href="/post/{{ lang }}/read" class="btn {% if filter=='read' %}active{% endif %}">ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ğµ</a>
    </div>

    {% for post in posts %}
    <div class="post-container" data-post-id="{{ post.id }}">
        <div class="fibonacci-gallery">
            {% for img in post.images %}
                <img src="{{ img }}" class="fibonacci-img img-{{ loop.index }}">
            {% endfor %}
        </div>

        <div class="post-title">{{ post.title }}</div>
        <div class="post-body">{{ post.body }}</div>

        <a href="/post/{{ post.id }}/comments/{{ lang }}" class="btn comment-btn">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸</a>
    </div>
    {% endfor %}

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const post = entry.target.closest(".post-container");
                        const postId = post.dataset.postId;
                        fetch(`/mark_read/${postId}`, {method: "POST"});
                    }
                });
            }, { threshold: 1.0 });

            document.querySelectorAll(".comment-btn").forEach(btn => {
                observer.observe(btn);
            });
        });
    </script>
</body>
</html>